{
  "meta": {
    "project": "Módulo Iniciativas (TestSprite)",
    "date": "2026-02-14",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "Módulo para gerenciar o ciclo de vida de iniciativas: cadastro/edição/exclusão, acompanhamento por marcos e evidências, painel executivo com KPIs e calendário de atividades. (Detalhes e casos de teste documentados nas páginas 1-12 do documento TestSprite fornecido.)",
  "core_goals": [
    "Permitir criação, edição, exclusão e gestão detalhada de iniciativas com validações de datas e soma de marcos.",
    "Registrar evidências de entrega por marco (comentários e arquivos) com controle de tipos e limite de 10MB.",
    "Apresentar um Painel Executivo com KPIs e gráficos filtráveis por analista/cliente/fazenda.",
    "Fornecer calendário de atividades com criação/remoção via UI, mesmo que em estado local (limitação conhecida).",
    "Garantir mensagens de feedback consistentes (toasts) e estados de loading/erro/empty."
  ],
  "features": [
    {
      "name": "Gestão de iniciativas",
      "description": "Criar, listar, editar, excluir e detalhar iniciativas; aplicar filtros por analista/cliente/fazenda; gerenciar marcos e time do projeto.",
      "user_flows": [
        "Navigate to /iniciativas/atividades -> Clicar em \"Nova Iniciativa\" -> Preencher campo Nome -> Preencher Data início -> Preencher Data final -> Selecionar Líder -> Adicionar marco (título, percentual, data limite) -> Adicionar segundo marco (título, percentual, data limite) -> Clicar em Salvar -> Ver toast \"Iniciativa salva com sucesso.\" -> Ver card da iniciativa na lista",
        "Navigate to /iniciativas/atividades -> Como admin, remover analista selecionado no cabeçalho -> Clicar em \"Nova Iniciativa\" -> Ver botão desabilitado ou aviso de seleção obrigatória (não permite criar)",
        "Navigate to /iniciativas/atividades -> Clicar em \"Nova Iniciativa\" -> Preencher Data início com valor posterior à Data final -> Clicar em Salvar -> Ver erro de validação indicando que início não pode ser posterior ao fim",
        "Navigate to /iniciativas/atividades -> Clicar em \"Nova Iniciativa\" -> Adicionar marcos cuja soma de percentuais ultrapasse 100% -> Clicar em Salvar -> Ver toast/erro de validação e não salvar",
        "Navigate to /iniciativas/atividades -> Clicar no card de uma iniciativa -> Abrir tela de Gestão (Geral & Marcos) -> Clicar em Editar -> Atualizar campos e clicar Atualizar -> Ver toast \"Iniciativa atualizada com sucesso.\"",
        "Navigate to /iniciativas/atividades -> Clicar no ícone lixeira no card -> Confirmar modal de exclusão -> Ver toast \"Iniciativa excluída com sucesso.\" -> Ver iniciativa removida da lista"
      ]
    },
    {
      "name": "Evidências de marcos",
      "description": "Registrar comentários e anexos (imagem, vídeo, planilha, documento) para cada marco; alternar status de conclusão do marco e manter histórico de evidências.",
      "user_flows": [
        "Navigate to /iniciativas/atividades -> Clicar no card de uma iniciativa -> Na aba Geral & Marcos, clicar em \"Clique para detalhar evidências\" (abre modal /iniciativas/evidencias) -> No modal, escrever comentário no textarea -> Clicar em \"Adicionar Comentário\" -> Anexar imagem (<=10MB) -> Anexar vídeo (<=10MB) -> Anexar planilha (<=10MB) -> Anexar documento (<=10MB) -> Clicar em \"Salvar Evidências\" -> Ver toast \"Evidências salvas.\" -> Clicar em um arquivo anexado -> Fazer download do arquivo -> Clicar em remover em outro arquivo -> Ver toast \"Arquivo removido.\" -> Fechar modal",
        "Navigate to /iniciativas/atividades -> Abrir evidências do marco (modal /iniciativas/evidencias) -> Tentar anexar arquivo maior que 10MB -> Ver erro de tamanho máximo (10MB) -> Arquivo não é anexado",
        "Navigate to /iniciativas/atividades -> Abrir evidências do marco -> Adicionar notas e anexos duplicados em condição de concorrência -> Clicar em \"Salvar Evidências\" -> Ver tratamento de conflito (unique constraint 23505 tratado pelo backend) e mensagem de erro/aviso apropriada",
        "Navigate to /iniciativas/atividades -> Abrir evidências do marco -> Alternar botão de status do marco para concluído -> Ver atualização do check do marco e recalculo de progresso na tela de Gestão"
      ]
    },
    {
      "name": "Painel executivo de iniciativas",
      "description": "Exibição consolidada de KPIs (Iniciativas Ativas, Entregas Realizadas, Em Andamento, Progresso Médio) e gráficos de distribuição por status e saúde do portfólio; respeita filtros de contexto.",
      "user_flows": [
        "Navigate to /iniciativas/overview -> Ver loading state -> Ver KPIs: Iniciativas Ativas, Entregas Realizadas, Em Andamento, Progresso Médio -> Ver gráfico de distribuição por status -> Ver gráfico de saúde do portfólio",
        "Navigate to /iniciativas/overview -> Alterar filtro de Analista/Cliente/Fazenda no cabeçalho -> Ver loading state de recarga -> Ver KPIs e gráficos atualizados conforme contexto selecionado",
        "Navigate to /iniciativas/overview -> Simular falha na consulta de dados -> Ver estado de erro com botão \"Tentar novamente\" -> Clicar em \"Tentar novamente\" -> Ver re-tentativa de carregamento e, em caso de sucesso, exibição dos KPIs"
      ]
    },
    {
      "name": "Calendário de atividades",
      "description": "Criar e remover eventos/atividades no calendário por meio de um modal de inclusão; eventos mantidos apenas em estado local (limitação conhecida).",
      "user_flows": [
        "Navigate to /calendar -> Selecionar intervalo no calendário -> Ver modal \"Inclua uma atividade\" -> Preencher nome da atividade -> Clicar em Confirmar inclusão -> Ver evento adicionado no calendário",
        "Navigate to /calendar -> Clicar em um evento existente -> Clicar para excluir -> Confirmar exclusão -> Ver evento removido do calendário",
        "Navigate to /calendar -> Criar evento via modal -> Recarregar a página -> Observar que o evento não persiste após reload (limitação: eventos em estado local somente)"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      "TypeScript",
      "React 19 + Vite",
      "Tailwind CSS + Lucide React",
      "Supabase (database, auth, storage), Recharts, FullCalendar"
    ],
    "routes": [
      {
        "path": "/",
        "file": "App.tsx",
        "auth_required": true,
        "description": "Shell principal da aplicação com navegação por agentes no sidebar."
      },
      {
        "path": "/iniciativas/overview",
        "file": "agents/InitiativesOverview.tsx",
        "auth_required": true,
        "description": "Painel Executivo de iniciativas (KPIs e gráficos)."
      },
      {
        "path": "/iniciativas/atividades",
        "file": "agents/InitiativesActivities.tsx",
        "auth_required": true,
        "description": "Lista, cadastro, edição, gestão e exclusão de iniciativas."
      },
      {
        "path": "/iniciativas/evidencias",
        "file": "components/EvidenciaEntregaModal.tsx",
        "auth_required": true,
        "description": "Modal de evidências por marco com comentários e anexos."
      },
      {
        "path": "/calendar",
        "file": "agents/CalendarAgent.tsx",
        "auth_required": true,
        "description": "Calendário com criação/remoção de atividades."
      }
    ],
    "features": [
      {
        "name": "Gestão de iniciativas",
        "description": "Cria, lista, edita, exclui e detalha iniciativas com filtros por analista, cliente e fazenda.",
        "files": [
          "agents/InitiativesActivities.tsx",
          "lib/initiatives.ts",
          "components/DateInputBR.tsx"
        ],
        "entry_route": "/iniciativas/atividades",
        "user_interactions": [
          "Clicar em \"Nova Iniciativa\" para abrir modal de cadastro.",
          "Preencher nome, datas, líder, time, marcos e salvar.",
          "Clicar no card para abrir a tela de gestão (Geral & Marcos / Time do Projeto).",
          "Clicar em \"Editar\" para atualizar dados e \"Excluir\" para remover iniciativa.",
          "Alternar status de marcos e abrir evidências por marco."
        ],
        "api_calls": [
          {
            "method": "SELECT",
            "endpoint": "supabase.public.initiatives"
          },
          {
            "method": "INSERT",
            "endpoint": "supabase.public.initiatives"
          },
          {
            "method": "UPDATE",
            "endpoint": "supabase.public.initiatives"
          },
          {
            "method": "DELETE",
            "endpoint": "supabase.public.initiatives"
          },
          {
            "method": "SELECT/INSERT/UPDATE/DELETE",
            "endpoint": "supabase.public.initiative_milestones"
          },
          {
            "method": "SELECT/INSERT/DELETE",
            "endpoint": "supabase.public.initiative_team"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Evidências de marcos",
        "description": "Registra evidências de entrega por marco com notas e arquivos por tipo.",
        "files": [
          "components/EvidenciaEntregaModal.tsx",
          "lib/milestoneEvidence.ts"
        ],
        "entry_route": "/iniciativas/evidencias",
        "user_interactions": [
          "Abrir modal de evidência ao clicar em \"Clique para detalhar evidências\".",
          "Adicionar comentário textual e salvar.",
          "Anexar imagem, vídeo, planilha ou documento.",
          "Baixar ou remover arquivos anexados.",
          "Alternar status concluído/não concluído do marco."
        ],
        "api_calls": [
          {
            "method": "SELECT/INSERT/UPDATE",
            "endpoint": "supabase.public.milestone_evidence"
          },
          {
            "method": "SELECT/INSERT/DELETE",
            "endpoint": "supabase.public.milestone_evidence_files"
          },
          {
            "method": "UPLOAD/REMOVE/CREATE_SIGNED_URL",
            "endpoint": "supabase.storage.bucket.milestone-evidence"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Painel executivo de iniciativas",
        "description": "Exibe indicadores consolidados e gráficos do portfólio.",
        "files": [
          "agents/InitiativesOverview.tsx",
          "lib/initiatives.ts"
        ],
        "entry_route": "/iniciativas/overview",
        "user_interactions": [
          "Acessar o painel para visualizar KPIs de iniciativas.",
          "Ver distribuição por status e saúde do portfólio.",
          "Recarregar dados ao trocar contexto de analista, cliente ou fazenda."
        ],
        "api_calls": [
          {
            "method": "SELECT",
            "endpoint": "supabase.public.initiatives"
          },
          {
            "method": "SELECT",
            "endpoint": "supabase.public.initiative_milestones"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Calendário de atividades",
        "description": "Cria e remove atividades em calendário via UI modal customizada.",
        "files": [
          "agents/CalendarAgent.tsx"
        ],
        "entry_route": "/calendar",
        "user_interactions": [
          "Selecionar intervalo no calendário e inserir nome da atividade.",
          "Confirmar inclusão de atividade no modal \"Inclua uma atividade\".",
          "Clicar em evento para excluir com confirmação."
        ],
        "api_calls": [
          {
            "method": "N/A",
            "endpoint": "local_state_only"
          }
        ],
        "auth_required": true
      }
    ],
    "known_limitations": [
      {
        "issue": "Eventos do calendário são mantidos apenas em estado local (não persistem após reload).",
        "location": "agents/CalendarAgent.tsx",
        "impact": "Atividades do calendário não ficam salvas no banco."
      },
      {
        "issue": "Atualização de iniciativa recria team e marcos (delete + insert) em vez de atualização granular.",
        "location": "lib/initiatives.ts",
        "impact": "IDs antigos de marcos/time mudam após edição completa."
      }
    ]
  }
}
